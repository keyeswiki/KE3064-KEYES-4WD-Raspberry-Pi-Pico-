# 第07课 超声波传感器

## 1. 实验说明：
小车上有个超声波传感器，超声波传感器是一种非常实惠的距离传感器，它可以检测前方是否存在障碍物，并且检测出传感器与障碍物的详细距离。
![Img](./media/7d7614bbb521e9e2a3e3a340df6ab817.png)
它的原理和蝙蝠飞行的原理一样，就是超声波传感器发送出一种频率很高的超声波信号，通常正常人耳朵的听力的声波范围是20Hz~20kHz，人类无法听到。这些超声波的信号若是碰到障碍物，就会立刻反射回来，在接收到返回的信息之后，通过判断发射信号和接收信号的时间差，计算出传感器和障碍物的距离。超声波传感器主要用于各种机器人项目中的物体躲避和测距，也常被用于水位传感，甚至作为一个停车传感器。
在本实验中，我们使用超声波传感器来测量距离，并将数据打印在串口监视器上。根据前面的接线图可知，超声波传感器模块集成端口是接在电机驱动底板上5V G G3 G4集合端口，Trig（T）引脚对应的是G3控制的；Echo（E）引脚对应的是G4控制的。

## 2. 元件知识：
**HC-SR04超声波传感器：** 像蝙蝠一样使用声纳来确定与物体的距离，它提供了精准的非接触范围检测，高精度和稳定的读数。它的操作不受阳光或黑色材料的影响，就像精密的照相机(在声学上像布料这样比较软的材料很难被探测到)。它带有超声波信号发射端和信号接收端。

我们看下超声波传感器模块的图片，两个像眼睛一样的东西，一个就是信号发射端（TRIG），一个就是信号接收端（ECHO）。    
![Img](./media/3f072289c869daa7a3234bdafe11e7c5.png)   

**参数：**
- 工作电压:+5V DC
- 静态电流: <2mA
- 工作电流: 15mA
- 有效角度: <15°
- 距离范围: 2cm – 400 cm
- 精度: 0.3 cm
- 测量角度: 30 degree
- 触发输入脉宽: 10us

**原理：**

最常用的超声测距的方法是回声探测法，如图：
![Img](./media/8da935ea7432106e23ba518a30e9f87f.png)
超声波发射器向某一方向发射超声波，在发射时刻的同时计数器开始计时，超声波在空气中传播，途中碰到障碍物面阻挡就立即反射回来，超声波接收器收到反射回的超声波就立即停止计时。超声波也是一种声波，其声速V与温度有关。一般情况下超声波在空气中的传播速度为340m/s，根据计时器记录的时间t，就可以计算出发射点距障碍物面的距离s，即：s=340t/2：
(1)采用IO口TRIG触发测距，给至少10us的高电平信号;
(2)模块自动发送8个40khz的方波，自动检测是否有信号返回；
(3)有信号返回，通过ECHO输出一个高电平，单片机读取到高电平持续的时间就是超声波从发射到返回的时间。
![Img](./media/8ed9be321fa2b4f1b4d809cd11ff5912.png)
超声波模块的电路图：
![Img](./media/2e276e6bc2c0b4a952cef828b900f740.png)

## 3. 实验代码：
本教程中使用的代码保存在：“**..\4. Python 教程\3. 项目课程**” 的路径中。你可以把代码移到任何地方。例如，我们将代码保存在**D盘**中，<span style="color: rgb(0, 209, 0);">路径为D:\3. 项目课程</span>。
![Img](./media/92103adf9654c97f49aea829c933d86f.png)

打开“**Thonny**”软件，点击“**此电脑**”→“**D:**”→“**3. 项目课程**”→“**第07课 超声波传感器**”，然后鼠标左键双击“**7_Ultrasonic_sensor.py**”。
![Img](./media/e953a2f7471b4b8f03f304a0cc7cbcb9.png)

```
'''
KEYES 4WD Raspberry Pi Pico 麦克纳姆轮智能小车
第07课
超声波传感器
'''

from machine import Pin,I2C
import mecanumCar_v2
import time

i2c = I2C(0, sda = Pin(20), scl = Pin(21), freq = 400000)
mecanumCar = mecanumCar_v2.Driver(i2c) 

while True:
    distance = mecanumCar.get_distance()
    print("distance is : {} cm".format(distance))
    time.sleep_ms(100)
    
```

## 4. 实验结果：
确保Raspberry Pi Pico主板已经连接到电脑上，单击“![Img](./media/555a25f055ba1b4c56ee4c3a28ffe5af.png)”。
![Img](./media/10ca8ee76b5cec385ed4298bc9b7cc11.png)

安上电池，将电机驱动底板上的电源拨码开关拨到ON一端，开启电源。单击“![Img](./media/5c05febdb56bb5ef370e897c012c1b91.png)”，代码开始执行，在Shell窗口中，你会看到超声波模块测得的距离，移动小车看到距离也在发生变化，如下图：
![Img](./media/f74af9442adfa135b6954e7758e76084.png)
![Img](./media/68dff81deeb6eba8ae66f03a433e6a33.png)

## 5. 代码说明: 

|mecanumCar.get_distance()| 获取超声波测得的距离，这里我们超声波的Trig引脚在GPIO3，Echo引脚在GPIO4，我们可在mecanumCar_v2文件中修改引脚号|
| :--: | :--: |
|print("distance is : {} cm".format(distance)) |字符串格式化打印，测到的距离distance在{}中显示 |
| time.sleep_ms(100) | 延时100毫秒 |




















